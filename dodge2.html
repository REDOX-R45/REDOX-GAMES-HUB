<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Neon Dodger 2025</title>
<style>
  body { margin: 0; background: #0a0f1e; color: #fff; font-family: Arial, sans-serif; overflow: hidden; user-select: none; }
  canvas { display: block; margin: 0 auto; background: #0a0f1e; }
  #ui { position: fixed; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; font-size: 18px; }
  .btn { background: rgba(0, 123, 255, 0.2); padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
  .btn:hover { background: rgba(0, 123, 255, 0.4); }
  #gameover, #startScreen { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; display: none; }
  #gameover h1, #startScreen h1 { color: cyan; font-size: 2.5em; text-shadow: 0 0 20px cyan, 0 0 40px cyan; }
  #startScreen button, #gameover button { background: cyan; color: #000; font-size: 18px; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
  #startScreen button:hover, #gameover button:hover { background: #00ffffaa; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
  <div>Score <span id="score">0</span></div>
  <div>Best <span id="best">0</span></div>
  <div>Lives <span id="lives">3</span></div>
  <div>Combo <span id="combo">x1</span></div>
  <div class="btn" id="pause">Pause (P)</div>
  <div class="btn" id="restart">Restart</div>
  <div class="btn" id="fs">Fullscreen</div>
</div>

<div id="startScreen">
  <h1>NEON DODGER 2025</h1>
  <button onclick="startGame()">Start</button>
</div>

<div id="gameover">
  <h1>GAME OVER</h1>
  <p>Score: <span id="finalScore">0</span></p>
  <p>Best: <span id="finalBest">0</span></p>
  <button onclick="restartGame()">Play again</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

let player = { x: canvas.width/2, y: canvas.height-100, size: 30, speed: 7, shielded: false, boost: false };
let obstacles = [];
let orbs = [];
let particles = [];
let trail = [];
let keys = {};
let score = 0;
let best = +localStorage.getItem("bestScore") || 0;
let lives = 3;
let combo = 1;
let gameOver = false;
let paused = false;
let lastHit = 0;
let shieldTimer = 0;
let boostTimer = 0;
let animationId;
let gameStarted = false;
let gameSpeedMultiplier = 1;

const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const livesEl = document.getElementById("lives");
const comboEl = document.getElementById("combo");
const goEl = document.getElementById("gameover");
const fsBtn = document.getElementById("fs");
const startScreen = document.getElementById("startScreen");

bestEl.textContent = best;
startScreen.style.display = "block";

function playBeep(freq=440, duration=0.1) {
  const ctxAudio = new (window.AudioContext||window.webkitAudioContext)();
  const osc = ctxAudio.createOscillator();
  const gain = ctxAudio.createGain();
  osc.type = "sine";
  osc.frequency.value = freq;
  osc.connect(gain);
  gain.connect(ctxAudio.destination);
  osc.start();
  gain.gain.exponentialRampToValueAtTime(0.0001, ctxAudio.currentTime + duration);
  osc.stop(ctxAudio.currentTime + duration);
}

function spawnObstacle() {
  let size = 30 + Math.random() * 30;
  let x = Math.random() * (canvas.width - size);
  let sides = 5 + Math.floor(Math.random()*4);
  obstacles.push({ x, y: -size, size, speed: (2 + Math.random() * 3)*gameSpeedMultiplier, sides });
}

function spawnOrb() {
  let x = Math.random() * (canvas.width - 20);
  let type = Math.random();
  if(type < 0.7) orbs.push({x, y:-20, size:20, speed:2*gameSpeedMultiplier, kind:"score"});
  else if(type < 0.85) orbs.push({x, y:-20, size:20, speed:2*gameSpeedMultiplier, kind:"shield"});
  else orbs.push({x, y:-20, size:20, speed:2*gameSpeedMultiplier, kind:"boost"});
}

function spawnParticles(x,y,color) {
  for(let i=0;i<10;i++) particles.push({x,y,dx:(Math.random()-0.5)*4,dy:(Math.random()-0.5)*4,life:30,color});
}

function drawPolygon(x, y, radius, sides, color, shadowColor) {
  if(sides < 3) return;
  ctx.beginPath();
  for(let i = 0; i < sides; i++) {
    let angle = (i * 2 * Math.PI / sides) - Math.PI/2;
    let px = x + radius * Math.cos(angle);
    let py = y + radius * Math.sin(angle);
    if(i===0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
  }
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.shadowColor = shadowColor;
  ctx.shadowBlur = 20;
  ctx.fill();
  ctx.shadowBlur = 0;
}

function drawPlayer() {
  trail.push({x:player.x+player.size/2, y:player.y+player.size/2});
  if(trail.length>30) trail.shift();
  trail.forEach((t,i)=>{ ctx.beginPath(); ctx.arc(t.x, t.y, i/2, 0, Math.PI*2); ctx.fillStyle = `rgba(0,255,255,${i/30})`; ctx.fill(); });

  ctx.shadowColor = "cyan";
  ctx.shadowBlur = 20;
  ctx.strokeStyle = "cyan";
  ctx.lineWidth = 3;
  ctx.strokeRect(player.x, player.y, player.size, player.size);
  ctx.shadowBlur = 0;

  let now = Date.now();
  if(player.shielded || now - lastHit < 1200) {
    let pulse = 5 + Math.sin(now/100)*5;
    ctx.beginPath();
    ctx.arc(player.x+player.size/2, player.y+player.size/2, player.size/1.5 + pulse, 0, Math.PI*2);
    ctx.strokeStyle = "rgba(0,255,255,0.7)";
    ctx.lineWidth = 4;
    ctx.shadowColor = "cyan";
    ctx.shadowBlur = 30;
    ctx.stroke();
    ctx.shadowBlur = 0;
  }

  if(player.boost) {
    ctx.shadowColor = "yellow";
    ctx.shadowBlur = 30;
    ctx.strokeStyle = "yellow";
    ctx.beginPath();
    ctx.arc(player.x+player.size/2, player.y+player.size/2, player.size*1.2, 0, Math.PI*2);
    ctx.stroke();
    ctx.shadowBlur = 0;
  }
}

function drawObstacles() { obstacles.forEach(o => drawPolygon(o.x + o.size/2, o.y + o.size/2, o.size/2, o.sides, "magenta", "magenta")); }

function drawOrbs() {
  orbs.forEach(o => {
    let color = o.kind==="score" ? "lime" : o.kind==="shield" ? "cyan" : "yellow";
    ctx.beginPath();
    ctx.arc(o.x + o.size/2, o.y + o.size/2, o.size/2, 0, Math.PI*2);
    ctx.fillStyle = color;
    ctx.shadowColor = color;
    ctx.shadowBlur = 20;
    ctx.fill();
    ctx.shadowBlur = 0;
  });
}

function drawParticles() { particles.forEach(p=>{ ctx.fillStyle = p.color; ctx.fillRect(p.x,p.y,3,3); }); }

function updateParticles() { particles = particles.filter(p=>p.life>0); particles.forEach(p=>{p.x+=p.dx;p.y+=p.dy;p.life--;}); }

function movePlayer() {
  let spd = player.speed * (player.boost ? 2 : 1);
  if(keys["ArrowLeft"]||keys["a"]) player.x-=spd;
  if(keys["ArrowRight"]||keys["d"]) player.x+=spd;
  if(keys["ArrowUp"]||keys["w"]) player.y-=spd;
  if(keys["ArrowDown"]||keys["s"]) player.y+=spd;
  player.x = Math.max(0,Math.min(canvas.width-player.size,player.x));
  player.y = Math.max(0,Math.min(canvas.height-player.size,player.y));
}

function checkCollisions() {
  let now = Date.now();
  obstacles.forEach(o=>{
    if(player.x<o.x+o.size && player.x+player.size>o.x && player.y<o.y+o.size && player.y+player.size>o.y) {
      if(!player.shielded && now-lastHit>1200) {
        lives = Math.max(0,lives-1); lastHit = now;
        spawnParticles(player.x+player.size/2, player.y+player.size/2, "red");
        playBeep(200,0.2);
        if(lives===0) endGame();
      }
    }
  });
  orbs.forEach((o,i)=>{
    if(player.x<o.x+o.size && player.x+player.size>o.x && player.y<o.y+o.size && player.y+player.size>o.y) {
      if(o.kind==="score"){ combo++; score+=10*combo; spawnParticles(o.x,o.y,"lime"); playBeep(600,0.1);}
      else if(o.kind==="shield"){ player.shielded=true; shieldTimer=Date.now(); spawnParticles(o.x,o.y,"cyan"); playBeep(300,0.2);}
      else if(o.kind==="boost"){ player.boost=true; boostTimer=Date.now(); spawnParticles(o.x,o.y,"yellow"); playBeep(800,0.15);}
      orbs.splice(i,1);
    }
  });
}

function update() {
  if(!gameStarted || gameOver){ animationId = requestAnimationFrame(update); return; }
  if(paused){ animationId = requestAnimationFrame(update); return; }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  movePlayer();
  obstacles.forEach(o=>o.y+=o.speed);
  orbs.forEach(o=>o.y+=o.speed);
  obstacles = obstacles.filter(o=>o.y<canvas.height+o.size);
  orbs = orbs.filter(o=>o.y<canvas.height+o.size);

  checkCollisions();
  drawPlayer(); drawObstacles(); drawOrbs(); drawParticles(); updateParticles();

  score++;
  scoreEl.textContent=score;
  livesEl.textContent=lives;
  comboEl.textContent="x"+combo;

  if(Math.random()<0.02) spawnObstacle();
  if(Math.random()<0.01) spawnOrb();

  if(player.shielded && Date.now()-shieldTimer>5000) player.shielded=false;
  if(player.boost && Date.now()-boostTimer>4000) player.boost=false;

  // Increase speed every 1000 points
  gameSpeedMultiplier = 1 + Math.floor(score/1000)*0.2;

  animationId = requestAnimationFrame(update);
}

function startGame(){ startScreen.style.display="none"; gameStarted=true; restartGame(); }

function endGame(){
  gameOver=true;
  goEl.style.display="block";
  document.getElementById("finalScore").textContent=score;
  best=Math.max(best,score);
  localStorage.setItem("bestScore",best);
  document.getElementById("finalBest").textContent=best;
  bestEl.textContent=best;
}

function restartGame(){
  paused=false; score=0; lives=3; combo=1; obstacles=[]; orbs=[]; particles=[]; trail=[]; gameOver=false; gameSpeedMultiplier=1;
  player.x=canvas.width/2; player.y=canvas.height-100; player.shielded=false; player.boost=false;
  goEl.style.display="none";
  if(animationId) cancelAnimationFrame(animationId);
  update();
}

document.addEventListener("keydown",e=>{ keys[e.key]=true; if(e.key==="p") paused=!paused; });
document.addEventListener("keyup",e=>{ keys[e.key]=false; });
canvas.addEventListener("mousemove",e=>{ player.x=e.clientX-player.size/2; player.y=e.clientY-player.size/2; });
document.getElementById("pause").onclick=()=>paused=!paused;
document.getElementById("restart").onclick=restartGame;
fsBtn.onclick=()=>{ if(!document.fullscreenElement) canvas.requestFullscreen(); else document.exitFullscreen(); };
</script>

</body>
</html>
